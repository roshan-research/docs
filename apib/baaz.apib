FORMAT: 1A
HOST: https://baaz.roshan-ai.ir

# مستندات API باز

باز یک محصول بومی برای جستجو در محتوای فارسی است.

## نکات مهم

- **احراز هویت**: تمام درخواست‌ها باید با هدر `Authorization: Token {token}` ارسال شوند.
- **فرمت زمان**: تمام زمان‌ها در فرمت `YYYY-MM-DD HH:MM:SS` هستند.
- **محدودیت اندازه**: حداكثر اندازه درخواست‌ها ۱۰ مگابایت است.
- **کش**: برخی اندپوینت‌ها مانند stats ممکن است از کش استفاده کنند و نتایج را تا ۵ دقیقه ذخیره کنند.
- **صفحه‌بندی**: برای اندپوینت‌هایی که تعداد زیادی نتیجه برمی‌گردانند، از پارامترهای `page` و `page_size` استفاده کنید.
- **محدودیت نرخ**: بیش از ۱۰۰ درخواست در دقیقه منجر به محدودیت موقت دسترسی می‌شود.

## خطاهای عمومی

| کد وضعیت | عنوان خطا | توضیحات |
|---------|----------|---------|
| 400 | Bad Request | پارامترهای درخواست نامعتبر هستند |
| 401 | Unauthorized | توکن احراز هویت نامعتبر یا منقضی شده است |
| 403 | Forbidden | دسترسی به منبع درخواستی مجاز نیست |
| 404 | Not Found | منبع درخواستی یافت نشد |
| 405 | Method Not Allowed | روش HTTP درخواستی برای این اندپوینت پشتیبانی نمی‌شود |
| 429 | Too Many Requests | تعداد درخواست‌ها بیش از حد مجاز است |
| 500 | Internal Server Error | خطای داخلی سرور |
| 503 | Service Unavailable | سرویس موقتاً در دسترس نیست |

# افزودن اسناد به ایندکس [/{index}/index]

این اندپوینت برای افزودن یا به‌روزرسانی دسته‌ای از اسناد در یک ایندکس مشخص استفاده می‌شود.

## مثال [POST]

اسناد جدیدی را به ایندکس اضافه می‌کند.

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکسی که اسناد به آن اضافه می‌شوند.

### هدرهای درخواست
*   **Authorization** (رشته، اجباری) - توکن احراز هویت شما به صورت Token {token}.
*   **Content-Type** (رشته، اجباری) - باید application/json باشد.

### بدنه درخواست
بدنه درخواست باید یک آبجکت JSON شامل کلید items باشد:
*   **items** (آرایه، اجباری) - آرایه‌ای از آبجکت‌های سند. هر آبجکت شامل فیلدهای زیر است:
    *   **id** (رشته، اجباری) - شناسه یکتای سند.
    *   **content** (رشته، اجباری) - محتوای اصلی سند که برای جستجو ایندکس می‌شود.
    *   **type** (رشته، اختیاری) - نوع سند. مقدار پیش‌فرض document است.
    *   **title** (رشته، اختیاری) - عنوان سند.
    *   **time** (رشته، اختیاری) - زمان سند با فرمت YYYY-MM-DD HH:MM:SS.

### پاسخ‌ها
*   **200 OK**: عملیات با موفقیت انجام شد.
*   **400 Bad Request**: داده‌های ارسالی نامعتبر هستند (مثلاً فیلدهای اجباری ارسال نشده‌اند).
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است یا ارسال نشده است.
*   **500 Internal Server Error**: خطایی در سمت سرور رخ داده است.

### پارامترهای پاسخ (200 OK)
*   **ids** (آرایه از رشته‌ها) - لیستی از شناسه‌های اسنادی که با موفقیت پردازش شده‌اند.
*   **indexing_results** (آبجکت) - خلاصه‌ای از نتیجه عملیات ایندکس.
    *   **successful** (عدد صحیح) - تعداد اسناد موفق.
    *   **failed** (عدد صحیح) - تعداد اسناد ناموفق.
    *   **errors** (آرایه) - لیستی از خطاهای رخ داده در صورت وجود.

+ Request (application/json)
    + Headers

            Authorization: Token {your_token}
            Content-Type: application/json

    + Body

            {
                "items": [
                    {
                        "id": "f2646930-64d7-47cc-93c1-e557777f1c489ad",
                        "content": "متن محتوای سند برای ایندکس شدن...",
                        "title": "عنوان نامه"
                    }
                ]
            }

+ Response 200 (application/json)
    + Body

            {
                "ids": ["f2646930-64d7-47cc-93c1-e557777f1c489ad"],
                "indexing_results": {
                    "successful": 1,
                    "failed": 0,
                    "errors": []
                }
            }


# جستجوی معنایی [/{index}/document/semantic_query]

این اندپوینت برای انجام جستجوی معنایی در محتوای اسناد یک ایندکس استفاده می‌شود.

## مثال [POST]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکسی که جستجو در آن انجام می‌شود.

### هدرهای درخواست
*   **Authorization** (رشته، اجباری) - توکن احراز هویت.
*   **Content-Type** (رشته، اجباری) - باید application/json باشد.

### بدنه درخواست
*   **text** (رشته، اجباری) - متن مورد نظر برای جستجو.
*   **size** (عدد صحیح، اختیاری) - حداکثر تعداد نتایج. مقدار پیش‌فرض ۱۰ است.

### پاسخ‌ها
*   **200 OK**: جستجو با موفقیت انجام شد.
*   **400 Bad Request**: پارامتر اجباری text ارسال نشده است.
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است.
*   **500 Internal Server Error**: خطایی در فرآیند جستجو رخ داده است.

### پارامترهای پاسخ (200 OK)
*   **results** (آرایه) - لیستی از نتایج جستجو. هر نتیجه یک آبجکت با فیلدهای زیر است:
    *   **document_id** (رشته) - شناسه سند یافت شده.
    *   **document_title** (رشته) - عنوان سند.
    *   **chunks** (آرایه) - قطعات متنی مرتبط با جستجو که هر کدام شامل text و score هستند.
*   **total** (عدد صحیح) - تعداد کل نتایج یافت شده.
*   **query_time_ms** (عدد صحیح) - زمان اجرای کوئری به میلی‌ثانیه.

+ Request (application/json)
    + Body

            {
                "text": "۴ فیلتر گردش نام ببر",
                "size": 5
            }

+ Response 200 (application/json)
    + Body

            {
                "results": [
                    {
                        "document_id": "f2646930-64d7-47cc-93c1-e557777f1c489ad",
                        "document_title": "عنوان نامه",
                        "chunks": [ { "text": "...", "score": 0.92 } ]
                    }
                ],
                "total": 1,
                "query_time_ms": 120
            }


# بررسی وضعیت اسناد [/{index}/document_status]

این اندپوینت وضعیت وجود و ایندکس شدن یک یا چند سند را بر اساس URL آن‌ها بررسی می‌کند.

## مثال [POST]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکس مورد نظر.

### بدنه درخواست
*   **document_urls** (آرایه از رشته‌ها، اجباری) - آرایه‌ای از آدرس‌های URL اسناد برای بررسی.

### پاسخ‌ها
*   **200 OK**: بررسی با موفقیت انجام شد.
*   **400 Bad Request**: بدنه درخواست خالی است یا فیلد document_urls ارسال نشده است.
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است.
*   **500 Internal Server Error**: خطای داخلی سرور هنگام بررسی وضعیت رخ داده است.

### پارامترهای پاسخ (200 OK)
*   **documents** (آبجکت) - یک آبجکت که کلیدهای آن URL اسناد و مقادیر آن وضعیت هر سند است.
    *   **exists** (بولین) - نشان می‌دهد که آیا سند در ایندکس وجود دارد.
    *   **indexed_at** (رشته) - زمان ایندکس شدن سند (در صورت وجود).
    *   **document_id** (رشته) - شناسه سند در ایندکس (در صورت وجود).
*   **total_checked** (عدد صحیح) - تعداد کل اسناد بررسی شده.
*   **total_existing** (عدد صحیح) - تعداد اسناد موجود در ایندکس.

+ Request (application/json)
    + Body

            {
                "document_urls": ["https://.../view?id=c81d4530-f78f-48a1-9654-b1a3cd73f30d"]
            }

+ Response 200 (application/json)
    + Body

            {
                "documents": {
                    "https://.../view?id=c81d4530...": {
                        "exists": true,
                        "indexed_at": "2025-07-20T14:30:00Z",
                        "document_id": "c81d4530-f78f-48a1-9654-b1a3cd73f30d"
                    }
                },
                "total_checked": 1,
                "total_existing": 1
            }


# حذف ایندکس [/{index}/delete_index]

این منبع برای حذف کامل یک ایندکس یا حذف اسناد با نوع مشخص از آن استفاده می‌شود.

## مثالی از کامل ایندکس [DELETE]

**احتیاط:** این عملیات غیرقابل بازگشت است و تمام داده‌های ایندکس را حذف می‌کند.

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکسی که باید حذف شود.

### پاسخ‌ها
*   **200 OK**: ایندکس با موفقیت حذف شد.
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است.
*   **500 Internal Server Error**: خطایی در فرآیند حذف ایندکس رخ داده است.

### پارامترهای پاسخ (200 OK)
*   **index** (رشته) - نام ایندکس حذف شده.
*   **doc_type** (رشته) - نوع اسناد حذف شده (در این حالت ALL).
*   **status** (رشته) - وضعیت کلی عملیات (success).

+ Request
    + Headers

            Authorization: Token {your_token}

+ Response 200 (application/json)
    + Body

            {
                "index": "TESTDELETE",
                "doc_type": "ALL",
                "status": "success"
            }


## مثالی از حذف اسناد بر اساس نوع [DELETE]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکس.

### بدنه درخواست
*   **type** (رشته، اجباری) - نوع اسنادی که باید حذف شوند.

### پاسخ‌ها
*   **200 OK**: اسناد با نوع مشخص با موفقیت حذف شدند.
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است.
*   **500 Internal Server Error**: خطایی در فرآیند حذف اسناد رخ داده است.

### پارامترهای پاسخ (200 OK)
*   **index** (رشته) - نام ایندکس.
*   **doc_type** (رشته) - نوع اسناد حذف شده.
*   **weaviate .deleted_count** (عدد صحیح) - تعداد اسناد حذف شده از موتور وکتور.
*   **status** (رشته) - وضعیت کلی عملیات.

+ Request (application/json)
    + Body

            {
                "type": "type2"
            }

+ Response 200 (application/json)
    + Body

            {
                "index": "TESTDELETE",
                "doc_type": "type2",
                "weaviate": { "deleted_count": 42 },
                "status": "success"
            }


# دریافت آمار ایندکس [/{index}/stats]

این اندپوینت آمار کلی یک ایندکس را برمی‌گرداند.

## مثال [GET]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکس برای دریافت آمار.

### پاسخ‌ها
*   **200 OK**: آمار ایندکس با موفقیت دریافت شد.
*   **401 Unauthorized**: توکن احراز هویت نامعتبر است.
*   **404 Not Found**: ایندکس مورد نظر یافت نشد.
*   **500 Internal Server Error**: خطای داخلی سرور.

### پارامترهای پاسخ (200 OK)
پاسخ این اندپوینت یک آبجکت است که کلیدهای آن به صورت داینامیک و بر اساس الگوی {index_name}_{document_type} ساخته می‌شوند. هر آبجکت شامل فیلدهای زیر است:
*   **docs_number** (عدد صحیح) - تعداد کل اسناد.
*   **index_size** (عدد صحیح) - حجم ایندکس به بایت.

+ Request
    + Headers

            Authorization: Token {your_token}

+ Response 200 (application/json)
    + Body

            {
                "ocr_2002_document": {
                    "docs_number": 1254,
                    "index_size": 52428800
                }
            }


# یافتن اسناد مشابه [/{index}/similar/documents]

این اندپوینت لیستی از اسناد مشابه با یک سند مرجع را برمی‌گرداند.

## مثال [POST]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکس.

### بدنه درخواست
*   **document_id** (رشته، اجباری) - شناسه سند مرجع.
*   **page_size** (عدد صحیح، اختیاری) - تعداد نتایج در هر صفحه (پیش‌فرض: ۱۰).
*   **page** (عدد صحیح، اختیاری) - شماره صفحه نتایج (پیش‌فرض: ۱).

### پاسخ‌ها
*   **200 OK**: اسناد مشابه با موفقیت یافت شدند.
*   **400 Bad Request**: پارامتر اجباری document_id ارسال نشده است.
*   **404 Not Found**: سند مرجع در ایندکس یافت نشد.

### پارامترهای پاسخ (200 OK)
*   **document_id** (رشته) - شناسه سند مرجع که برای جستجو استفاده شد.
*   **similar_documents** (آرایه) - لیستی از اسناد مشابه. هر سند یک آبجکت با فیلدهای id, title, similarity_score و غیره است.
*   **total_results** (عدد صحیح) - تعداد کل نتایج یافت شده.

+ Request (application/json)
    + Body

            {
                "document_id": "f2646930-64d7-47cc-93c1-e557777f1c489ad",
                "page_size": 10
            }

+ Response 200 (application/json)
    + Body

            {
                "document_id": "f2646930-64d7-47cc-93c1-e557777f1c489ad",
                "similar_documents": [
                    {
                        "id": "another-document-id",
                        "title": "عنوان سند مشابه",
                        "similarity_score": 0.85
                    }
                ],
                "total_results": 5
            }


# مشاهده جزئیات سند [/{index}/document/view{?id}]

این اندپوینت جزئیات کامل یک سند را با استفاده از شناسه آن برمی‌گرداند.

## مثال [GET]

### پارامترهای URL
*   **index** (رشته، اجباری) - نام ایندکس.

### پارامترهای کوئری
*   **id** (رشته، اجباری) - شناسه سندی که باید مشاهده شود.

### پاسخ‌ها
*   **200 OK**: جزئیات سند با موفقیت دریافت شد.
*   **400 Bad Request**: پارامتر کوئری id ارسال نشده است.
*   **404 Not Found**: سند مورد نظر در ایندکس یافت نشد.

### پارامترهای پاسخ (200 OK)
بدنه پاسخ یک آبجکت JSON است که شامل تمام فیلدهای ذخیره شده برای سند مورد نظر است. فیلدهای اصلی عبارتند از:
*   **id** (رشته) - شناسه یکتای سند.
*   **type** (رشته) - نوع سند.
*   **title** (رشته) - عنوان سند.
*   **content** (رشته) - محتوای کامل سند.
*   و سایر فیلدهای مرتبط...

+ Request
    + Headers

            Authorization: Token {your_token}

+ Response 200 (application/json)
    + Body

            {
                "id": "f2646930-64d7-47cc-93c1-e557777f1c489ad",
                "type": "document",
                "title": "عنوان نامه",
                "content": "متن کامل سند..."
            }

# بررسی وضعیت سلامت ای‌پی‌آی [/healthcheck]

این اندپوینت برای بررسی وضعیت کلی و سلامت سرویس API استفاده می‌شود.

## مثال [GET]

یک پاسخ ساده برای تأیید اینکه سرویس فعال و در دسترس است، برمی‌گرداند. این اندپوینت هیچ پارامتر ورودی نیاز ندارد.

### پاسخ‌ها
*   **200 OK**: سرویس فعال و در دسترس است.
*   **503 Service Unavailable**: سرویس به طور موقت در دسترس نیست یا یکی از وابستگی‌های آن دچار مشکل شده است.

### پارامترهای پاسخ (200 OK)
*   **status** (رشته) - وضعیت کلی سرویس که در حالت موفقیت‌آمیز برابر با ok است.
*   **message** (رشته) - یک پیام توصیفی درباره وضعیت سرور.

+ Response 200 (application/json)
    + Body

            {
                "status": "ok",
                "message": "Server is up and ready"
            }
